<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ご相談フォーム</title>
  <meta name="description" content="お部屋探しのご希望条件を1分ほどで入力できる相談フォームです。" />

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    :root{
      --bg: #f7faf8;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #6b7280;
      --line: #e5e7eb;
      --accent: #1f9d63;
      --accent-2: #0f7a4a;
      --accent-soft: #e7f7ef;
      --danger: #dc2626;
      --shadow: 0 10px 28px rgba(2, 24, 12, 0.08);
      --radius-lg: 16px;
      --radius-md: 10px;
      --radius-sm: 8px;
    }

    *{ box-sizing: border-box; }
    html, body{
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Segoe UI", sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 500px at 85% -10%, var(--accent-soft), transparent 60%),
        radial-gradient(900px 500px at -10% 10%, #f0fbf5, transparent 55%),
        var(--bg);
    }

    .page{
      min-height: 100dvh;
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: 20px;
    }

    header{
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
      background: rgba(247, 250, 248, 0.8);
      border-bottom: 1px solid rgba(0,0,0,0.04);
    }

    .header-inner{
      max-width: 920px;
      margin: 0 auto;
      padding: 16px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .brand{
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    /* 高解像度アイコンを綺麗に見せる想定でサイズを少し最適化 */
    .brand-icon{
      width: 30px;
      height: 30px;
      border-radius: 9px;
      object-fit: cover;
      flex: 0 0 30px;
      background: #fff;
      box-shadow:
        0 2px 8px rgba(2, 24, 12, 0.12),
        inset 0 0 0 1px rgba(255,255,255,0.5);
      /* 画像の縮小表示を前提にシャープ感を保ちやすく */
      image-rendering: auto;
    }

    /* 画像が設定されていない時のフォールバック */
    .brand-badge{
      width: 30px;
      height: 30px;
      border-radius: 9px;
      background: linear-gradient(135deg, var(--accent), #38d48a);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.5);
      display: none;
    }

    .brand small{
      font-weight: 600;
      color: var(--muted);
    }

    .container{
      width: min(920px, 92vw);
      margin: 0 auto 24px;
    }

    .hero{
      background: linear-gradient(135deg, #ffffff, #ffffff 55%, var(--accent-soft));
      border: 1px solid var(--line);
      border-radius: var(--radius-lg);
      padding: 26px 22px 22px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }
    .hero::after{
      content: "";
      position: absolute;
      right: -120px;
      top: -140px;
      width: 320px;
      height: 320px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(31,157,99,0.18), transparent 65%);
      pointer-events: none;
    }

    /* ヒーロー見出し周りを微調整 */
    .hero-head{
      display: flex;
      flex-direction: column;
      gap: 6px; /* 余白を少し詰めて上寄せ感 */
    }

    .hero .meta{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      background: var(--accent-soft);
      border: 1px solid rgba(31,157,99,0.18);
      border-radius: 999px;
      font-size: 12px;
      color: var(--accent-2);
      font-weight: 600;
      /* 「少しだけ左上に綺麗に」 */
      margin-left: -2px;
      transform: translateY(-2px);
      width: fit-content;
    }

    .hero h1{
      margin: 0 0 2px;
      /* ちょっとだけ大きく */
      font-size: clamp(24px, 3.6vw, 31px);
      /* ほんの少し上に詰める感覚 */
      letter-spacing: 0.01em;
    }

    .hero p{
      margin: 0 0 6px;
      color: var(--muted);
      line-height: 1.6;
    }

    form{
      margin-top: 18px;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      padding: 10px 0 4px;
    }

    .section{
      padding: 18px 22px 6px;
      border-top: 1px dashed rgba(0,0,0,0.06);
    }
    .section:first-child{ border-top: none; }

    .section-title{
      display: flex;
      align-items: baseline;
      gap: 8px;
      margin: 0 0 12px;
      font-size: 15px;
      font-weight: 700;
    }
    .section-title .req{
      color: var(--danger);
      font-size: 12px;
      font-weight: 700;
    }
    .section-sub{
      margin: -6px 0 12px;
      font-size: 12px;
      color: var(--muted);
    }

    .field{
      display: grid;
      gap: 8px;
      margin-bottom: 14px;
    }

    label{
      font-size: 12.5px;
      font-weight: 600;
      color: #111827;
    }

    input[type="text"],
    input[type="tel"],
    input[type="number"],
    select,
    textarea{
      width: 100%;
      border: 1px solid var(--line);
      border-radius: var(--radius-md);
      padding: 12px 12px;
      font-size: 15px;
      outline: none;
      background: #fff;
      transition: border .15s ease, box-shadow .15s ease, background .15s ease;
    }
    textarea{
      min-height: 110px;
      resize: vertical;
    }

    input::placeholder, textarea::placeholder{
      color: #9aa3af;
    }

    input:focus, select:focus, textarea:focus{
      border-color: rgba(31,157,99,0.55);
      box-shadow: 0 0 0 4px rgba(31,157,99,0.12);
      background: #fcfffd;
    }

    .grid-2{
      display: grid;
      gap: 16px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 720px){
      .grid-2{ grid-template-columns: 1fr 1fr; }
    }

    .checks{
      display: grid;
      gap: 10px 14px;
      grid-template-columns: 1fr 1fr;
    }
    @media (min-width: 720px){
      .checks{
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .check-item{
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 10px;
      border: 1px solid var(--line);
      border-radius: var(--radius-sm);
      background: #fff;
      transition: border .15s ease, background .15s ease, transform .08s ease;
    }
    .check-item:hover{
      border-color: rgba(31,157,99,0.35);
      background: #fbfffd;
    }
    .check-item:active{
      transform: translateY(1px);
    }

    input[type="checkbox"]{
      width: 18px;
      height: 18px;
      accent-color: var(--accent);
    }

    .hint{
      font-size: 11.5px;
      color: var(--muted);
    }

    .actions{
      padding: 18px 22px 22px;
      display: grid;
      gap: 10px;
    }

    .btn{
      border: none;
      border-radius: 14px;
      padding: 14px 14px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: transform .08s ease, filter .15s ease, box-shadow .15s ease;
    }
    .btn-primary{
      background: linear-gradient(135deg, var(--accent), #39d489);
      color: white;
      box-shadow: 0 10px 18px rgba(31,157,99,0.22);
    }
    .btn-primary:hover{
      filter: brightness(1.02);
    }
    .btn-primary:active{
      transform: translateY(1px);
    }

    .btn-ghost{
      background: #fff;
      border: 1px solid var(--line);
      color: #111827;
    }

    .error{
      color: var(--danger);
      font-size: 11.5px;
      font-weight: 600;
      display: none;
    }

    footer{
      padding: 10px 18px 26px;
      color: var(--muted);
      font-size: 11px;
      text-align: center;
    }

    /* サンクス画面 */
    .thankyou{
      margin-top: 18px;
      background: linear-gradient(135deg, #ffffff, #ffffff 55%, var(--accent-soft));
      border: 1px solid var(--line);
      border-radius: var(--radius-lg);
      padding: 32px 22px 28px;
      box-shadow: var(--shadow);
    }
    .thankyou h2{
      margin: 0 0 8px;
      font-size: clamp(20px, 3vw, 24px);
    }
    .thankyou p{
      margin: 0;
      color: var(--muted);
      line-height: 1.6;
    }
  </style>
</head>

<body>
  <div class="page">
    <header>
      <div class="header-inner">
        <div class="brand">
          <!--
            ▼アイコン差し替え用
            高解像度で綺麗に見せたい場合は、
            できれば 60px以上の正方形画像を用意してここに指定してください。
          -->
          <img
            class="brand-icon"
            src="YOUR_SUUMIN_ICON_URL"
            alt="お部屋探しのスーミン"
            onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block';"
          />
          <span class="brand-badge" aria-hidden="true"></span>

          <div>
            <div>ご相談フォーム</div>
            <small>お部屋探しのスーミン</small>
          </div>
        </div>
        <div class="pill-note">約1分で入力</div>
      </div>
    </header>

    <main class="container">
      <!-- HERO -->
      <section class="hero" id="heroSection">
        <div class="hero-head">
          <span class="meta">希望条件をご入力ください</span>
          <h1>かんたん1分入力で<br>お部屋探しをスタート</h1>
          <p>
            ご希望条件をご入力後、担当者より、条件に合うお部屋をご提案いたします。
          </p>
        </div>
      </section>

      <!-- THANK YOU -->
      <section class="thankyou" id="thankYouSection" style="display:none;">
        <h2>ご回答ありがとうございます。</h2>
        <p>担当者より、条件に合うお部屋をご提案いたします。</p>
      </section>

      <!-- FORM -->
      <form id="consultForm" novalidate>
        <!-- 基本情報 -->
        <div class="section">
          <div class="grid-2">
            <div class="field">
              <div class="section-title">お名前 <span class="req">必須</span></div>
              <div class="section-sub">ひらがなだけでも可能です</div>
              <label for="name">お名前</label>
              <input id="name" name="name" type="text" required />
              <div class="error" data-error-for="name">お名前を入力してください。</div>
            </div>

            <div class="field">
              <div class="section-title">ご職業 <span class="req">必須</span></div>
              <label for="occupation">ご職業</label>
              <select id="occupation" name="occupation" required>
                <option value="">選択してください</option>
                <option>会社員</option>
                <option>公務員</option>
                <option>派遣・アルバイト</option>
                <option>個人事業主・自営業</option>
                <option>経営者・役員</option>
                <option>夜職</option>
                <option>学生</option>
                <option>無職・その他</option>
              </select>
              <div class="error" data-error-for="occupation">ご職業を選択してください。</div>
            </div>
          </div>

          <div class="grid-2">
            <div class="field">
              <div class="section-title">ご入居時期 <span class="req">必須</span></div>
              <label for="moveIn">ご入居時期</label>
              <select id="moveIn" name="moveIn" required>
                <option value="">選択してください</option>
                <option>1ヶ月以内</option>
                <option>1〜2ヶ月以内</option>
                <option>2〜3ヶ月以内</option>
                <option>それ以上先</option>
                <option>未定</option>
              </select>
              <div class="error" data-error-for="moveIn">ご入居時期を選択してください。</div>
            </div>

            <div class="field">
              <div class="section-title">職場の最寄り駅 <span class="hint">任意</span></div>
              <label for="workStation">職場の最寄り駅（任意）</label>
              <input id="workStation" name="workStation" type="text" placeholder="例：新宿 / 渋谷 / 大手町" />
            </div>
          </div>
        </div>

        <!-- 住み替え理由 -->
        <div class="section">
          <div class="section-title">住み替えの理由 <span class="req">必須</span></div>
          <div class="section-sub">（複数選択可）</div>

          <div class="checks" role="group" aria-label="住み替えの理由">
            <label class="check-item"><input type="checkbox" name="reasons" value="転勤・転職" />転勤・転職</label>
            <label class="check-item"><input type="checkbox" name="reasons" value="結婚・同棲" />結婚・同棲</label>
            <label class="check-item"><input type="checkbox" name="reasons" value="契約更新" />契約更新</label>
            <label class="check-item"><input type="checkbox" name="reasons" value="独立" />独立</label>
            <label class="check-item"><input type="checkbox" name="reasons" value="気分転換" />気分転換</label>
            <label class="check-item"><input type="checkbox" name="reasons" value="その他" />その他</label>
          </div>
          <div class="error" data-error-for="reasons">住み替え理由を1つ以上選択してください。</div>
        </div>

        <!-- 希望条件 -->
        <div class="section">
          <div class="section-title">希望条件</div>

          <div class="field">
            <div class="section-title">希望エリア <span class="req">必須</span></div>
            <label for="area">希望エリア</label>
            <input id="area" name="area" type="text" placeholder="例：中野 / 新宿 / 目黒 / 山手線内側 など" required />
            <div class="hint">複数エリアOK。優先順位があれば一緒に記載してください。</div>
            <div class="error" data-error-for="area">希望エリアを入力してください。</div>
          </div>

          <div class="field">
            <div class="section-title">希望の間取り <span class="req">必須</span></div>
            <div class="section-sub">（複数選択可）</div>
            <div class="checks" role="group" aria-label="希望の間取り">
              <label class="check-item"><input type="checkbox" name="layouts" value="1R" />1R</label>
              <label class="check-item"><input type="checkbox" name="layouts" value="1K" />1K</label>
              <label class="check-item"><input type="checkbox" name="layouts" value="1DK" />1DK</label>
              <label class="check-item"><input type="checkbox" name="layouts" value="1LDK" />1LDK</label>
              <label class="check-item"><input type="checkbox" name="layouts" value="2LDK" />2LDK</label>
              <label class="check-item"><input type="checkbox" name="layouts" value="3LDK" />3LDK</label>
            </div>
            <div class="error" data-error-for="layouts">希望の間取りを1つ以上選択してください。</div>
          </div>

          <div class="grid-2">
            <div class="field">
              <div class="section-title">お家賃の上限 <span class="req">必須</span></div>
              <label for="rentMax">お家賃の上限（管理費込）</label>
              <input
                id="rentMax"
                name="rentMax"
                type="number"
                inputmode="decimal"
                step="0.1"
                min="0"
                placeholder="例：12 / 13.5 / 15"
                required
              />
              <div class="hint">単位は「万円」を想定しています。</div>
              <div class="error" data-error-for="rentMax">お家賃の上限を入力してください。</div>
            </div>

            <div class="field">
              <div class="section-title">築年数 <span class="hint">任意</span></div>
              <label for="age">築年数（任意）</label>
              <select id="age" name="age">
                <option value="">選択してください</option>
                <option>1年以内</option>
                <option>3年以内</option>
                <option>5年以内</option>
                <option>7年以内</option>
                <option>10年以内</option>
                <option>15年以内</option>
                <option>20年以内</option>
                <option>その他</option>
              </select>
              <div class="hint">こだわりがなければ未選択でOK。</div>
            </div>
          </div>

          <div class="field">
            <div class="section-title">こだわり条件 <span class="hint">任意</span></div>
            <label for="preferences">こだわり条件</label>
            <textarea
              id="preferences"
              name="preferences"
              placeholder="例：2階以上 / バストイレ別 / 宅配BOX / 角部屋 / ペット可 など"
            ></textarea>
          </div>
        </div>

        <!-- 連絡先 -->
        <div class="section">
          <div class="section-title">ご連絡先</div>

          <div class="field">
            <div class="section-title">お電話番号 <span class="req">必須</span></div>
            <label for="phone">お電話番号</label>
            <input
              id="phone"
              name="phone"
              type="tel"
              inputmode="tel"
              placeholder="例：09012345678"
              required
              pattern="^[0-9-+ ]{9,15}$"
            />
            <div class="error" data-error-for="phone">有効なお電話番号を入力してください。</div>
          </div>
        </div>

        <!-- アクション -->
        <div class="actions">
          <button class="btn btn-primary" type="submit">回答する</button>
          <button class="btn btn-ghost" type="reset">入力をリセット</button>
          <div id="formMsg" class="hint"></div>
        </div>
      </form>
    </main>

    <footer></footer>
  </div>

  <script>
    // =========================
    // LIFF settings
    // =========================
    const LIFF_ID = "YOUR_LIFF_ID"; // ←ここを差し替え

    let liffReady = false;

    async function initLiffSafe(){
      try{
        if (!window.liff) return;
        await liff.init({ liffId: LIFF_ID });
        liffReady = true;
      }catch(e){
        liffReady = false;
      }
    }

    window.addEventListener("load", () => {
      initLiffSafe();
    });
  </script>

  <script>
    (function(){
      const form = document.getElementById("consultForm");
      const msg = document.getElementById("formMsg");
      const hero = document.getElementById("heroSection");
      const thankYou = document.getElementById("thankYouSection");

      const showError = (name, on) => {
        const el = document.querySelector(`[data-error-for="${name}"]`);
        if(!el) return;
        el.style.display = on ? "block" : "none";
      };

      const getCheckedValues = (selector) => {
        return Array.from(document.querySelectorAll(selector))
          .filter(i => i.checked)
          .map(i => i.value);
      };

      const onlyDigits = (v) => (v || "").replace(/[^\d]/g, "");

      // 送信時の厳密判定（日本の一般的な10〜11桁を許容）
      const isPhoneValidForSubmit = (raw) => {
        const d = onlyDigits(raw);
        return d.length === 10 || d.length === 11;
      };

      // 入力中のゆるい判定：
      // - 11桁(または10〜11桁)に到達したらOK
      // - 先頭が一般的な文頭なら途中でもOK扱いでエラーを消す
      const isPhoneValidForLive = (raw) => {
        const d = onlyDigits(raw);
        if (!d) return false;
        if (isPhoneValidForSubmit(raw)) return true;

        if (d.length >= 3) {
          const p3 = d.slice(0, 3);
          if (["090","080","070","050"].includes(p3)) return true;
        }
        if (d.length >= 2) {
          const p2 = d.slice(0, 2);
          if (["03","06"].includes(p2)) return true;
        }
        return false;
      };

      const validators = {
        name: () => form.name.value.trim().length > 0,
        occupation: () => !!form.occupation.value.trim(),
        moveIn: () => !!form.moveIn.value.trim(),
        reasons: () => getCheckedValues(`input[name="reasons"]`).length > 0,
        area: () => form.area.value.trim().length > 0,
        layouts: () => getCheckedValues(`input[name="layouts"]`).length > 0,
        rentMax: () => {
          const v = form.rentMax.value;
          return !(v === "" || Number(v) <= 0);
        },
        phone: () => isPhoneValidForSubmit(form.phone.value.trim())
      };

      const validateAll = () => {
        let ok = true;
        const keys = ["name","occupation","moveIn","reasons","area","layouts","rentMax","phone"];
        keys.forEach(k => showError(k, false));

        keys.forEach(k => {
          const pass = validators[k]();
          if (!pass) {
            showError(k, true);
            ok = false;
          }
        });
        return ok;
      };

      const buildPayload = () => {
        return {
          name: form.name.value.trim(),
          occupation: form.occupation.value.trim(),
          moveIn: form.moveIn.value.trim(),
          reasons: getCheckedValues(`input[name="reasons"]`),
          area: form.area.value.trim(),
          workStation: form.workStation.value.trim(),
          layouts: getCheckedValues(`input[name="layouts"]`),
          rentMaxManYen: Number(form.rentMax.value || 0),
          buildingAge: form.age.value.trim(),
          preferences: form.preferences.value.trim(),
          phone: form.phone.value.trim(),
          submittedAt: new Date().toISOString()
        };
      };

      const buildLineText = (p) => {
        const reasons = (p.reasons && p.reasons.length) ? p.reasons.join(" / ") : "未選択";
        const layouts = (p.layouts && p.layouts.length) ? p.layouts.join(" / ") : "未選択";

        return (
`【希望条件フォーム】
お名前：${p.name}
職業：${p.occupation}
入居時期：${p.moveIn}
住み替え理由：${reasons}

希望エリア：${p.area}
職場最寄り：${p.workStation || "未記入"}
間取り：${layouts}
家賃上限：${p.rentMaxManYen}万円
築年数：${p.buildingAge || "指定なし"}

こだわり：
${p.preferences || "未記入"}

電話：${p.phone}`
        );
      };

      const showThankYou = () => {
        if (hero) hero.style.display = "none";
        form.style.display = "none";
        if (thankYou) thankYou.style.display = "block";
        window.scrollTo({ top: 0, behavior: "smooth" });
      };

      // ==============
      // ライブエラー解除
      // ==============
      const wireLiveClear = () => {
        form.name.addEventListener("input", () => {
          if (validators.name()) showError("name", false);
        });

        form.occupation.addEventListener("change", () => {
          if (validators.occupation()) showError("occupation", false);
        });

        form.moveIn.addEventListener("change", () => {
          if (validators.moveIn()) showError("moveIn", false);
        });

        form.area.addEventListener("input", () => {
          if (validators.area()) showError("area", false);
        });

        form.rentMax.addEventListener("input", () => {
          if (validators.rentMax()) showError("rentMax", false);
        });

        // 住み替え理由
        document.querySelectorAll(`input[name="reasons"]`).forEach(cb => {
          cb.addEventListener("change", () => {
            if (validators.reasons()) showError("reasons", false);
          });
        });

        // 間取り
        document.querySelectorAll(`input[name="layouts"]`).forEach(cb => {
          cb.addEventListener("change", () => {
            if (validators.layouts()) showError("layouts", false);
          });
        });

        // 電話番号：入力中はゆるく、送信時は厳密
        form.phone.addEventListener("input", () => {
          const v = form.phone.value.trim();
          if (isPhoneValidForLive(v)) showError("phone", false);
        });

        form.phone.addEventListener("blur", () => {
          // フォーカスアウト時は少し厳しめに
          if (validators.phone()) showError("phone", false);
        });
      };

      wireLiveClear();

      // ==============
      // SUBMIT
      // ==============
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        msg.textContent = "";

        const ok = validateAll();
        if (!ok) return;

        const payload = buildPayload();

        // LIFFクライアント内ならメッセージ送信を試みる
        try{
          if (window.liff && liffReady && liff.isInClient()) {
            const text = buildLineText(payload);
            await liff.sendMessages([{ type: "text", text }]);
          }
        }catch(err){
          // 送信失敗でもUIはサンクスへ（ユーザー体験優先）
        }

        showThankYou();
      });

      form.addEventListener("reset", () => {
        ["name","occupation","moveIn","reasons","area","layouts","rentMax","phone"]
          .forEach(k => showError(k, false));
        msg.textContent = "";
      });
    })();
  </script>
</body>
</html>
